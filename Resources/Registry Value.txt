:: Создание папок Mount, ISO, Updates в диске C.
mkdir C:\ISO
mkdir C:\Mount
mkdir C:\Updates

:: Узнать индекс и количество редакций в образе.
dism.exe /Get-WimInfo /WimFile:"C:\ISO\Sources\install.wim"

:: Монтирование образа.
dism.exe /Mount-Image /ImageFile:"C:\ISO\Sources\install.wim" /Index:# /MountDir:"C:\mount"
:: Выбери свой индекс в образе
:: Пример /Index:1

:: Добавление обновлений в ISO образ.
dism.exe /Add-Package /image:"C:\mount" /PackagePath:"C:\Updates\*.msu"

# Получить список всех UWP-приложений
dism.exe /Image:C:\Mount /Get-ProvisionedAppxPackages

:: Удаление ненужных UWP приложений.
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:MSTeams_1.0.0.0_x64__8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:MicrosoftWindows.CrossDevice_1.25062.28.0_neutral_~_cw5n1h2txyewy
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:MicrosoftWindows.Client.WebExperience_525.18101.90.9_neutral_~_cw5n1h2txyewy
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:MicrosoftCorporationII.QuickAssist_2025.331.2057.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.YourPhone_1.25062.84.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.WindowsSoundRecorder_2021.2504.0.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.WindowsFeedbackHub_2024.125.1522.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.WindowsCamera_2022.2505.2.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.WindowsAlarms_2021.2503.4.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.Windows.DevHome_0.1701.597.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.Todos_2.120.7961.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.PowerAutomateDesktop_11.2506.143.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.Paint_11.2412.295.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.OutlookForWindows_1.0.0.0_neutral__8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.MicrosoftStickyNotes_6.1.5.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.MicrosoftSolitaireCollection_4.22.3190.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.MicrosoftOfficeHub_19.2506.56051.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.GetHelp_10.2407.22193.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.BingWeather_4.54.63017.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.BingSearch_2022.1.33.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Microsoft.BingNews_4.1.24002.0_neutral_~_8wekyb3d8bbwe
dism.exe /Image:C:\mount /Remove-ProvisionedAppxPackage /PackageName:Clipchamp.Clipchamp_4.3.10120.0_neutral_~_yxz26nhyzhsrt

:: Отключение авто-установки ненужного софта с Центра Обновлений.
reg.exe load "HKLM\TempDefaultUser" "C:\mount\Users\Default\NTUSER.DAT"
reg.exe add "HKLM\TempDefaultUser\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v "SilentInstalledAppsEnabled" /t REG_DWORD /d 0 /f
reg.exe add "HKLM\TempDefaultUser\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v "PreInstalledAppsEnabled" /t REG_DWORD /d 0 /f
reg.exe add "HKLM\TempDefaultUser\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v "OemPreInstalledAppsEnabled" /t REG_DWORD /d 0 /f
reg.exe add "HKLM\TempDefaultUser\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v "PreInstalledAppsEverEnabled" /t REG_DWORD /d 0 /f
reg.exe add "HKLM\TempDefaultUser\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v "SoftLandingEnabled" /t REG_DWORD /d 0 /f
reg.exe add "HKLM\TempDefaultUser\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v "ContentDeliveryAllowed" /t REG_DWORD /d 0 /f
reg.exe delete "HKLM\TempDefaultUser\Software\Microsoft\Windows\CurrentVersion\Run" /v  "OneDriveSetup" /f
:: #1 Исправление ошибки 0xc1900500 - 0x20000 в Media Cretion Tool в РФ.
reg.exe add "HKLM\TempDefaultUser\Control Panel\International\Geo" /v "Name" /t REG_SZ /d "US" /f
reg.exe add "HKLM\TempDefaultUser\Control Panel\International\Geo" /v "Nation" /t REG_SZ /d "244" /f
reg.exe unload "HKLM\TempDefaultUser"

reg.exe load "HKLM\TempSYSTEM" "C:\mount\Windows\System32\config\SYSTEM"
:: Отключение авто-кодирования диска через BitLocker.
reg.exe add "HKLM\TempSYSTEM\ControlSet001\Control\Session Manager" /v DisableWpbtExecution /t REG_DWORD /d 1 /f
:: Отключение выполнение программы из таблицы Windows Platform Binary Table (WPBT) при запуске Windows.
reg.exe add "HKLM\TempSYSTEM\ControlSet001\Control\BitLocker" /v PreventDeviceEncryption /t REG_DWORD /d 1 /f
reg.exe unload "HKLM\TempSYSTEM"

reg.exe load "HKLM\TempSOFTWARE" "C:\mount\Windows\System32\config\SOFTWARE"
:: Очистка меню пуск от рекламных приложений и ссылок на них.
reg.exe add "HKLM\TempSOFTWARE\Microsoft\PolicyManager\current\device\Start" /v ConfigureStartPins /t REG_SZ /d '{\"pinnedList\": [{}]}' /f
:: Отключение сетевой учетной записи в OOBE.
reg.exe add "HKLM\TempSOFTWARE\Microsoft\Windows\CurrentVersion\OOBE" /v "HideOnlineAccountScreens" /t REG_DWORD /d 1 /f
reg.exe add "HKLM\TempSOFTWARE\Microsoft\Windows\CurrentVersion\OOBE" /v "HideWirelessSetupInOOBE" /t REG_DWORD /d 1 /f
:: Отключение авто-установки/обновления DevHome, Outlook, CrossDevice.
reg.exe delete "HKLM\TempSOFTWARE\Microsoft\WindowsUpdate\Orchestrator\UScheduler_Oobe\OutlookUpdate" /f
reg.exe delete "HKLM\TempSOFTWARE\Microsoft\WindowsUpdate\Orchestrator\UScheduler_Oobe\DevHomeUpdate" /f
reg.exe delete "HKLM\TempSOFTWARE\Microsoft\WindowsUpdate\Orchestrator\UScheduler_Oobe\CrossDeviceUpdate" /f
:: #2 Исправление ошибки 0xc1900500 - 0x20000 в Media Cretion Tool в РФ. [Используй PowerRun]
reg.exe add "HKLM\TempSOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing" /v "CountryCode" /t REG_SZ /d "US" /f

reg.exe unload "HKLM\TempSOFTWARE"

:: Размонтирование образа и сохранение изменений.
dism.exe /Unmount-Image /MountDir:C:\mount /Commit

:: Удаление ненужных редакций.
dism.exe /Delete-Image /ImageFile:C:\ISO\Sources\install.wim /Index:# /CheckIntegrity
